CREATE PROCEDURE extraer_imbds(in nacion varchar(25))
BEGIN
    declare v_peli int;
    declare v_actores int;
    declare v_direct int;
    DECLARE peliAux CURSOR FOR
    SELECT ID_pelicula from Peliculas where nacionalidad = nacion;
    declare actoresAux cursor for
    SELECT ID_actor from Actores where nacionalidad = nacion;
    declare directAux cursor for
    SELECT ID_director from Directores where nacionalidad = nacion;

  
   

    -- define el nombre de la tabla según la nacionalidad

    -- crea una nueva relación
    set @sql = concat('CREATE TABLE IF NOT EXISTS ', nacion, ' (code_imbd VARCHAR(255))');
    prepare stmt from @sql;
    execute stmt;

    

    --peliculas--
    OPEN peliAux;
    fetch peliAux into v_peli;

    WHILE @@FETCH_STATUS = 0 DO
        SET @sql = CONCAT('INSERT INTO ', nacion, ' (code_imdb) VALUES (''', v_peli, ''')');
        PREPARE stmt FROM @sql;
        EXECUTE stmt;

        fetch peliAux into v_peli;
    END WHILE;

    close peliAux;

    --actores
    open actoresAux;
    fetch actoresAux into v_actores;

    WHILE @@FETCH_STATUS = 0 DO
        SET @sql = CONCAT('INSERT INTO ', nacion, ' (code_imdb) VALUES (''', v_actores, ''')');
        PREPARE stmt FROM @sql;
        EXECUTE stmt;

        fetch actoresAux into v_actores;
    END WHILE;

    close actoresAux;

    --directores
    open directAux;
    fetch directAux into v_direct;

    WHILE @@FETCH_STATUS = 0 DO
        SET @sql = CONCAT('INSERT INTO ', nacion, ' (code_imdb) VALUES (''', v_direct, ''')');
        PREPARE stmt FROM @sql;
        EXECUTE stmt;

        fetch directAux into v_direct;
    END WHILE;

    close directAux;

END;
